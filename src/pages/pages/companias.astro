---
import LayoutSidebar from '../../app/LayoutSidebar.astro';
import Tarjetas from '../../modules/tarjetasEmpresas.astro';
import { supabase } from '../../lib/supabase';
import Alerta from '../../components/alertageneral.astro';

const { cookies, redirect } = Astro;

const accessToken = cookies.get('sb-access-token');
const refreshToken = cookies.get('sb-refresh-token');

if (!accessToken || !refreshToken) {
	return redirect('/sign-in');
}

const { error } = await supabase.auth.setSession({
	refresh_token: refreshToken.value,
	access_token: accessToken.value,
});

if (error) {
	cookies.delete('sb-access-token', {
		path: '/',
	});
	cookies.delete('sb-refresh-token', {
		path: '/',
	});

	return redirect('/sign-in');
}
---

<LayoutSidebar>
	<Alerta />
	<Tarjetas />
</LayoutSidebar>
