---
import NavPagination from '../components/NavPagination.astro';
import { supabase } from "../lib/supabase";
import Alerta from "../components/alertageneral.astro"

  /* =========================
   4) Búsqueda + paginación
   ========================= */
const rawQ = (Astro.url.searchParams.get("rawQ") || "").trim();
const rawPage = parseInt(Astro.url.searchParams.get("page") || "1", 10);
const page = Number.isFinite(rawPage) && rawPage > 0 ? rawPage : 1;

const pageSize = 20;
const from = (page - 1) * pageSize;
const to = from + pageSize - 1;

let servicio: any[] = []; // ✅ usa "servicios" (plural) para pintar
let errorMsg = "";
let total = 0;
let totalPages = 1;

let query = supabase
  .from("formularios")
  .select(`
    form_id,
 	slug,
    revision,
    titulo,
    descripcion,
    estado,
	schema_json,
	tema_json,
	created_at,
	updated_at
  `, { count: "exact" })
  .order("titulo", { ascending: false });

if (rawQ) {
  const safe = rawQ.replace(/[,*]/g, ""); // evita romper .or
  query = query.or([
    `titulo.ilike.*${safe}*`,
    `slug.ilike.*${safe}*`,
    `descripcion.ilike.*${safe}*`
  ].join(","));
}

// Paginamos
const { data, error, count } = await query.range(from, to);

if (error) {
  errorMsg = error.message ?? "Error desconocido";
  console.error("Error leyendo servicios:", errorMsg);
} else {
  servicio = data ?? [];
  total = count ?? 0;
  totalPages = Math.max(1, Math.ceil(total / pageSize));
}

---
<Alerta />
<div>
	<div
		class="p-4 bg-white block sm:flex items-center justify-between border-b border-gray-200 lg:mt-1.5 dark:bg-[#1d1d1d] dark:border-gray-700 w-full"
	>
		<div class="w-full mb-1">
			<div class="mb-4">
				<nav class="flex mb-5" aria-label="Breadcrumb">
					<ol
						class="inline-flex items-center space-x-1 text-sm font-medium md:space-x-2"
					>
						<li class="inline-flex items-center">
							<a
								href="/"
								class="inline-flex items-center text-gray-700 hover:text-[#967432] dark:text-gray-300 dark:hover:text-white"
							>
								<svg
									class="w-5 h-5 mr-2.5"
									fill="currentColor"
									viewBox="0 0 20 20"
									xmlns="http://www.w3.org/2000/svg"
									><path
										d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"
									></path></svg
								>
								Inicio
							</a>
						</li>
						<li>
							<div class="flex items-center">
								<svg
									class="w-6 h-6 text-gray-400"
									fill="currentColor"
									viewBox="0 0 20 20"
									xmlns="http://www.w3.org/2000/svg"
									><path
										fill-rule="evenodd"
										d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
										clip-rule="evenodd"></path></svg
								>
								<a
									href="#"
									class="ml-1 text-gray-700 hover:text-[#967432] md:ml-2 dark:text-gray-300 dark:hover:text-white"
									>servicios</a
								>
							</div>
						</li>
						
					</ol>
				</nav>
				<h1
					class="text-xl font-semibold text-gray-900 sm:text-2xl dark:text-white"
				>
					Lista de Formularios creados
				</h1>
			</div>
			<div class="items-center justify-between block sm:flex">
				<div class="flex items-center mb-4 sm:mb-0">
					<form class="lg:pr-3" method="GET">
						<label for="users-search" class="sr-only">Buscar</label>
						<div class="relative mt-1 lg:w-64 xl:w-96 flex">
							<input
								type="search"
								name="rawQ"
								value={rawQ}
								class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-[#8c681d] focus:border-[#8c681d] block w-full p-2.5 dark:bg-[#1d1d1d] dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]"
								placeholder="Buscar por nombre, correo, empresa…"
							/>
							<button class="inline-flex items-center justify-center w-1/2 px-3 py-2 text-sm font-medium text-center text-white rounded-lg bg-[#8c681d] hover:bg-[#8c681d] focus:ring-4 focus:ring-primary-300 sm:w-auto dark:bg-[#967432] dark:hover:bg-[#8c681d] dark:focus:ring-[#8c681d] ml-2 mr-2">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0s.41-1.08 0-1.49zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14"></path></svg> 
								Buscar
							</button>
						</div>
					</form>
					<div class="flex pl-0 mt-3 space-x-1 sm:pl-2 sm:mt-0">
						<a href="/crud/formularios" type="button" class="inline-flex items-center justify-center sm:w-auto px-3 py-2 text-sm font-medium text-center text-white rounded-lg bg-[#8c681d] hover:bg-[#8c681d] focus:ring-4 focus:ring-primary-300 dark:bg-[#967432] dark:hover:bg-[#8c681d] dark:focus:ring-[#8c681d] w-full">
							<svg class="w-5 h-5 mr-2 -ml-1" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="m899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6c-.3 1.5-.4 3-.4 4.4c0 14.4 11.6 26 26 26h723c1.5 0 3-.1 4.4-.4c14.2-2.4 23.7-15.9 21.2-30M204 390h272V182h72v208h272v104H204zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260z"></path></svg>
						Limpiar busqueda
						</a> 
					</div>
				</div>

				<div class="flex items-center ml-auto space-x-2 sm:space-x-3">
					<a
						href="/crud/formularios/"
						type="button"
						class="inline-flex items-center justify-center w-1/2 px-3 py-2 text-sm font-medium text-center text-white rounded-lg bg-[#8c681d] hover:bg-[#8c681d] focus:ring-4 focus:ring-primary-300 sm:w-auto dark:bg-[#967432] dark:hover:bg-[#8c681d] dark:focus:ring-[#8c681d] h-full"
					>
						<svg
							class="w-5 h-5 mr-2 -ml-1"
							fill="none"
							stroke="currentColor"
							stroke-width="1.5"
							viewBox="0 0 24 24"
							xmlns="http://www.w3.org/2000/svg"
							aria-hidden="true"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"
							></path>
						</svg>
						Actualizar
					</a>
					<button
						id="createProductButton"
						class="inline-flex items-center justify-center w-1/2 px-3 py-2 text-sm font-medium text-center text-white rounded-lg bg-[#8c681d] hover:bg-[#8c681d] focus:ring-4 focus:ring-primary-300 sm:w-auto dark:bg-[#967432] dark:hover:bg-[#8c681d] dark:focus:ring-[#8c681d]"
						type="button"
						data-drawer-target="drawer-create-product-default"
						data-drawer-show="drawer-create-product-default"
						aria-controls="drawer-create-product-default"
						data-drawer-placement="right"
					>
						<svg
							class="w-5 h-5 mr-2 -ml-1"
							fill="currentColor"
							viewBox="0 0 20 20"
							xmlns="http://www.w3.org/2000/svg"
							><path
								fill-rule="evenodd"
								d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
								clip-rule="evenodd"></path></svg
						>
						Añadir formulario
					</button>
					<a
						href="https://surveyjs.io/create-free-survey"
						target="_blank"
						type="button"
						class="inline-flex items-center justify-center w-1/2 px-3 py-2 text-sm font-medium text-center text-white rounded-lg bg-[#8c681d] hover:bg-[#8c681d] focus:ring-4 focus:ring-primary-300 sm:w-auto dark:bg-[#967432] dark:hover:bg-[#8c681d] dark:focus:ring-[#8c681d]"
					>
						<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 -ml-1" viewBox="0 0 24 24"><path fill="currentColor" d="M19 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h6v2H5v12h12v-6zM13 3v2h4.586l-7.793 7.793l1.414 1.414L19 6.414V11h2V3z"/></svg>
						Crear formulario
					</a>
				</div>
			</div>
		</div>
	</div>

	<div class="flex flex-col">
		<div class="overflow-x-auto">
			<div class="inline-block min-w-full align-middle">
				<div class="overflow-hidden shadow">
					<table
						class="min-w-full divide-y divide-gray-200 table-fixed dark:divide-gray-600"
					>
						<thead class="bg-gray-100 dark:bg-neutral-700">
							<tr>
								<th scope="col" class="p-4">
									<div class="flex items-center">
										<input
											id="checkbox-all"
											aria-describedby="checkbox-1"
											type="checkbox"
											class="w-4 h-4 border-gray-300 rounded bg-gray-50 focus:ring-3 focus:ring-primary-300 dark:focus:ring-[#967432] dark:ring-offset-gray-800 dark:bg-neutral-700 dark:border-gray-600"
										/>
										<label for="checkbox-all" class="sr-only">checkbox</label>
									</div>
								</th>

								{
									[
										'Titulo',
										'categoria',
										'Descripción',
										'Revision',
										'Fecha de actualización',
										'Fecha de creación',
										'estado',
										'Acciones'
									].map((th) => (
										<th
											scope="col"
											class="p-4 text-xs font-medium text-left text-gray-500 uppercase dark:text-gray-400"
										>
											{th}
										</th>
									))
								}
							</tr>
						</thead>

						<tbody
							class="bg-white divide-y divide-gray-200 dark:bg-[#1d1d1d] dark:divide-gray-700"
						>
							{
								servicio?.map((sr) => (
									<tr class="hover:bg-gray-100 dark:hover:bg-neutral-700">
										<td class="w-4 p-4">
											<div class="flex items-center">
												<input
													id={`checkbox-${sr.form_id}`}
													aria-describedby="checkbox-1"
													type="checkbox"
													class="w-4 h-4 border-gray-300 rounded bg-gray-50 focus:ring-3 focus:ring-primary-300 dark:focus:ring-[#967432] dark:ring-offset-gray-800 dark:bg-neutral-700 dark:border-gray-600"
												/>
												<label for={`checkbox-${sr.form_id}`} class="sr-only">
													checkbox
												</label>
											</div>
										</td>
										<td class="p-4 text-sm font-normal text-gray-500 whitespace-nowrap dark:text-gray-400">
											<div class="text-base font-semibold text-gray-900 dark:text-white">
												<data value="name">{sr.titulo}</data>
											</div>
											<div class="text-sm font-normal text-gray-500 dark:text-gray-400">
												<data value="category">{sr.slug}</data>
											</div>
										</td>
										
										<td class="p-4 overflow-hidden text-base font-normal text-gray-500 truncate dark:text-gray-400">
											<data value="description">{sr.slug}</data>
										</td>
										<td class="p-4 overflow-hidden text-base font-normal text-gray-500 truncate dark:text-gray-400">
											<data value="description">{sr.descripcion}</data>
										</td>
										<td class="p-4 text-base font-medium text-gray-900 whitespace-nowrap dark:text-white">
											<data value="price">{sr.revision}</data>
										</td>
										<td class="p-4 text-base font-medium text-gray-900 whitespace-nowrap dark:text-white">
											<data value="price">
												{
													sr.updated_at &&
													new Date(sr.updated_at)
													.toLocaleDateString('es-ES', { 
														day: '2-digit', 
														month: '2-digit', 
														year: 'numeric' 
													})
													.replace(/\//g, '-')
												}
											</data>
										</td>
										<td class="p-4 text-base font-medium text-gray-900 whitespace-nowrap dark:text-white">
											<data value="price">
												{
													sr.created_at &&
													new Date(sr.created_at)
													.toLocaleDateString('es-ES', {
														day: '2-digit',
														month: '2-digit', 
														year: 'numeric' 
													})
													.replace(/\//g, '-')
												}
											</data>
										</td>
										<td class="p-4 text-base font-medium text-gray-900 whitespace-nowrap dark:text-white">
											<div class="flex items-center">
													{sr.estado === true ? (
														<div class="h-2.5 w-2.5 rounded-full bg-green-400 mr-2" />
														<span>Activo</span>
													) : (
														<div class="h-2.5 w-2.5 rounded-full bg-red-500 mr-2" />
														<span>Inactivo</span>
													)}
													
											</div>
										</td>

										<td class="p-4 space-x-2 whitespace-nowrap">
											<button
												type="button"
												id="updateProductButton"
												data-service-update
												data-id={sr.form_id}
												data-titulo={sr.titulo}
												data-json={JSON.stringify(sr.schema_json) || ''}
												data-tema={JSON.stringify(sr.tema_json) || ''}
												data-slug={sr.slug || ''}
												data-descripcion={sr.descripcion || ''}
												data-estado={sr.estado ? "true" : "false"}
												data-drawer-target="drawer-update-product-default"
												data-drawer-show="drawer-update-product-default"
												aria-controls="drawer-update-product-default"
												data-drawer-placement="right"
												class="inline-flex items-center px-3 py-2 text-sm font-medium text-center text-white rounded-lg bg-[#8c681d] hover:bg-[#8c681d] focus:ring-4 focus:ring-primary-300 dark:bg-[#967432] dark:hover:bg-[#8c681d] dark:focus:ring-[#8c681d]"
											>
												<svg
													class="w-4 h-4 mr-2"
													fill="currentColor"
													viewBox="0 0 20 20"
													xmlns="http://www.w3.org/2000/svg"
												>
													<svg>
														<path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
														<path
															fill-rule="evenodd"
															d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"
															clip-rule="evenodd"
														/>
													</svg>
												</svg>
												Actualizar Servicio
											</button>
											<button type="button"
											data-link-share
											data-id={sr.form_id}
											data-modal-target="course-modal" data-modal-toggle="course-modal" class="text-gray-900 bg-white hover:bg-gray-100 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-gray-600 dark:bg-neutral-700 dark:border-gray-700 dark:text-white dark:hover:bg-neutral-700">
												<svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
													<path d="M17.5 3A3.5 3.5 0 0 0 14 7L8.1 9.8A3.5 3.5 0 0 0 2 12a3.5 3.5 0 0 0 6.1 2.3l6 2.7-.1.5a3.5 3.5 0 1 0 1-2.3l-6-2.7a3.5 3.5 0 0 0 0-1L15 9a3.5 3.5 0 0 0 6-2.4c0-2-1.6-3.5-3.5-3.5Z"/>
												</svg>
											</button>
											<button
													id={`dd-btn-${sr.form_id}`}
													data-dropdown-toggle={`dd-${sr.form_id}`}
													class="inline-flex items-center p-2 text-sm font-medium text-center text-gray-900 bg-gray-100 rounded-lg hover:bg-gray-100 focus:ring-4 focus:outline-none dark:text-white focus:ring-gray-50 dark:bg-neutral-700 dark:hover:bg-neutral-700 dark:focus:ring-gray-600"
													type="button"
													aria-haspopup="true"
													aria-expanded="false"
													>
													<svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 4 15">
														<path d="M3.5 1.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm0 6.041a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm0 5.959a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z"/>
													</svg>
											</button>
											<div
											id={`dd-${sr.form_id}`}
											class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow-sm w-44 dark:bg-neutral-700 dark:divide-gray-600"
											role="menu"
											aria-labelledby={`dd-btn-${sr.form_id}`}
											data-dropdown-placement="bottom-start"
											>
												<ul class="py-2 text-sm text-gray-700 dark:text-gray-200" role="none">
													<li><button
													type="button"
													data-open-estado                 
													data-form-id={sr.form_id}
													data-form-titulo={`${sr.titulo}`.trim()}
													data-form-slug={`${sr.slug}`.trim()}
													data-form-descripcion={`${sr.descripcion}`.trim()}
													data-form-estado={`${sr.estado}`.trim()}
													data-drawer-target="drawer-delete-product-default"
													data-drawer-show="drawer-delete-product-default"
													aria-controls="drawer-delete-product-default"
													data-drawer-placement="right"
													class="block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
													role="menuitem"
													>
													Archivar
													</button>
													</li>
													<li><button
													type="button"
													data-open-desarchivado               
													data-form-id={sr.form_id}
													data-form-titulo={`${sr.titulo}`.trim()}
													data-form-slug={`${sr.slug}`.trim()}
													data-form-descripcion={`${sr.descripcion}`.trim()}
													data-form-estado={`${sr.estado}`.trim()}
													data-drawer-target="desarchivar-menu"
													data-drawer-show="desarchivar-menu"
													aria-controls="desarchivar-menu"
													data-drawer-placement="right"
													class="block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white"
													role="menuitem"
													>
													Desarchivar
													</button>
													</li>
													<li>
														<a href={`/forms/${sr.form_id}`} target="_blank" rel="noopener noreferrer" class="block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">
															Ver Formulario
														</a>
													</li>
												</ul>
											</div>
										</td>
									</tr>
								))
							}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

	<!-- Edit Product Drawer -->
	<div
		id="drawer-update-product-default"
		class="fixed top-0 right-0 z-40 w-full h-screen max-w-lg p-4 overflow-y-auto transition-transform translate-x-full bg-white dark:bg-[#1d1d1d]"
		tabindex="-1"
		aria-labelledby="drawer-label"
		aria-hidden="true" 
	>
		<h5
			id="drawer-label"
			class="inline-flex items-center mb-6 text-sm font-semibold text-gray-500 uppercase dark:text-gray-400"
		>
			Actualizar Formulario
		</h5>
		<button
			type="button"
			data-drawer-dismiss="drawer-update-product-default"
			aria-controls="drawer-update-product-default"
			class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 absolute top-2.5 right-2.5 inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white"
		>
			<svg
				aria-hidden="true"
				class="w-5 h-5"
				fill="currentColor"
				viewBox="0 0 20 20"
				xmlns="http://www.w3.org/2000/svg"
				><path
					fill-rule="evenodd"
					d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
					clip-rule="evenodd"></path></svg
			>
			<span class="sr-only">Cerrar menu</span>
		</button>

		<form action="/api/update/admin-update-forms" method="post">
			<div class="space-y-4">
				<input type="hidden" name="service_id" id="modal_form_id" value=""/>
				<div>
					<label
						for="nombre_update-service"
						class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
						>Titulo del formulario</label
					>
					<input
						type="text"
						name="titulo-form"
						id="titulo-update-form"
						class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#967432] focus:border-[#967432] block w-full p-2.5 dark:bg-neutral-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]"
						value=""
						placeholder="inserta el titulo del formulario"
						required=""
					/>
				</div>
				<div>
					<label
						for="categoria_service"
						class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
						>Categoria</label
					>
					<input
						type="text"
						name="categoria-form"
						id="categoria-form-update"
						class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#967432] focus:border-[#967432] block w-full p-2.5 dark:bg-neutral-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]"
						value=""
						placeholder="Añade la categoria del formulario"
						required=""
					/>
				</div>
				<div>
					<label
						for="precio-servicio"
						class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
						>Pega el JSON del formulario</label
					>
					<textarea
						name="json-update"
						id="json-form"
						class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#967432] focus:border-[#967432] block w-full p-2.5 dark:bg-neutral-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]"
						placeholder="Añade el Json del formulario"
						required=""
						rows="10"
					></textarea
					>
				</div>
				<div>
					<label
						for="descripcion-servicio"
						class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
						>Tema del form (opcional)</label
					>
					<textarea
						id="tema-form"
						name="tema-form-update"
						rows="2"
						class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-[#8c681d] focus:border-[#8c681d] dark:bg-neutral-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]"
						placeholder="Añade el codigo json del tema de tu formulario"
						></textarea
					>
				</div>
				<div>
					<label
						for="descripcion-servicio"
						class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
						>Descripcion</label
					>
					<textarea
						id="descripcion-form"
						name="descripcion-form-update"
						rows="4"
						class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-[#8c681d] focus:border-[#8c681d] dark:bg-neutral-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]"
						placeholder="Añade una descripcion para el form"
						></textarea
					>
				</div>
				<div>
					<label
						for="updaterol_estado"
						class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
						>Estado</label
					>
					<select
						id="update-form-estado"
						name="estado"
						class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#8c681d] focus:border-[#8c681d] block w-full p-2.5 dark:bg-neutral-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]"
					>
						<option value="" disabled="" selected="">--</option>
						<option value="true">Activo</option>
						<option value="false">Inactivo</option>
					</select>
				</div>
			</div>
			<div
				class="bottom-0 left-0 flex justify-center w-full pb-4 mt-4 space-x-4 sm:absolute sm:px-4 sm:mt-0"
			>
				<button
					type="submit"
					class="w-full justify-center text-white bg-[#8c681d] hover:bg-[#8c681d] focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-[#967432] dark:hover:bg-[#8c681d] dark:focus:ring-[#8c681d]"
				>
					Actualizar
				</button>
				<button
					data-drawer-hide="drawer-update-product-default"
					type="button"
					class="w-full justify-center text-red-600 inline-flex items-center hover:text-white border border-red-600 hover:bg-red-600 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:border-red-500 dark:text-red-500 dark:hover:text-white dark:hover:bg-red-600 dark:focus:ring-red-900 dark:bg-[#1d1d1d]"
				>
					Cancelar
				</button>
			</div>
		</form>
	</div>

	<!-- Delete Product Drawer -->
	<div
		id="drawer-delete-product-default"
		class="fixed top-0 right-0 z-40 w-full h-screen max-w-xs p-4 overflow-y-auto transition-transform translate-x-full bg-white dark:bg-[#1d1d1d]"
		tabindex="-1"
		aria-labelledby="drawer-label"
		aria-hidden="true"
	>
		<h5
			id="drawer-label"
			class="inline-flex items-center text-sm font-semibold text-gray-500 uppercase dark:text-gray-400"
		>
			Archivar Formulario
		</h5>
		<button
			type="button"
			data-drawer-dismiss="drawer-delete-product-default"
			aria-controls="drawer-delete-product-default"
			class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 absolute top-2.5 right-2.5 inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white"
		>
			<svg
				aria-hidden="true"
				class="w-5 h-5"
				fill="currentColor"
				viewBox="0 0 20 20"
				xmlns="http://www.w3.org/2000/svg"
				><path
					fill-rule="evenodd"
					d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
					clip-rule="evenodd"></path></svg
			>
			<span class="sr-only">Cerrar menu</span>
		</button>
		<svg
			class="w-10 h-10 mt-8 mb-4 text-red-600"
			fill="none"
			stroke="currentColor"
			viewBox="0 0 24 24"
			xmlns="http://www.w3.org/2000/svg"
			><path
				stroke-linecap="round"
				stroke-linejoin="round"
				stroke-width="2"
				d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg
		>
		<h3 class="mb-6 text-lg text-gray-500 dark:text-gray-400">
			¿Estas seguro de querer archivar este servicio?
		</h3>
		<form action="/api/update/admin-services-delete" id="archivar_form" method="post" class="flex">
			<input type="hidden" name="servicio_id" id="servicio_id"/>
			<input type="hidden" name="servicio_activo" value="false">
			<button
			type="submit"
			class="text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm inline-flex items-center px-3 py-2.5 text-center mr-2 dark:focus:ring-red-900"
			>
				Si, estoy seguro
			</button>
			<button
				class="text-gray-900 bg-white hover:bg-gray-100 focus:ring-4 focus:ring-primary-300 border border-gray-200 font-medium inline-flex items-center rounded-lg text-sm px-3 py-2.5 text-center dark:bg-[#1d1d1d] dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-neutral-700 dark:focus:ring-gray-700"
				type="button"
				data-drawer-dismiss="drawer-delete-product-default"
				aria-controls="drawer-delete-product-default"
			>
				No, cancelar
			</button>
		</form>
		
		
	</div>

	<!-- desarchivar Product Drawer -->
	<div
		id="desarchivar-menu"
		class="fixed top-0 right-0 z-40 w-full h-screen max-w-xs p-4 overflow-y-auto transition-transform translate-x-full bg-white dark:bg-[#1d1d1d]"
		tabindex="-1"
		aria-labelledby="drawer-label"
		aria-hidden="true"
	>
		<h5
			id="drawer-label"
			class="inline-flex items-center text-sm font-semibold text-gray-500 uppercase dark:text-gray-400"
		>
			Desarchivar servicio
		</h5>
		<button
			type="button"
			data-drawer-dismiss="desarchivar-menu"
			aria-controls="desarchivar-menu"
			class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 absolute top-2.5 right-2.5 inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white"
		>
			<svg
				aria-hidden="true"
				class="w-5 h-5"
				fill="currentColor"
				viewBox="0 0 20 20"
				xmlns="http://www.w3.org/2000/svg"
				><path
					fill-rule="evenodd"
					d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
					clip-rule="evenodd"></path></svg
			>
			<span class="sr-only">Cerrar menu</span>
		</button>
		
		<svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 mt-8 mb-4 text-emerald-500" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M12 21a9 9 0 0 0 7.51-13.961l-7.155 7.95a2 2 0 0 1-2.687.262L6.4 12.8a1 1 0 0 1 1.2-1.6l3.268 2.451l7.346-8.161A9 9 0 1 0 12 21" clip-rule="evenodd"/></svg>
		<h3 class="mb-6 text-lg text-gray-500 dark:text-gray-400">
			¿Estas seguro de querer archivar este servicio?
		</h3>
		<form action="/api/update/admin-services-add" id="desarchivar_form" method="post" class="flex">
			<input type="hidden" name="des_servicio_id" id="des_servicio_id"/>
			<input type="hidden" name="des_servicio_activo" value="true">
			<button
			type="submit"
			class="text-white bg-emerald-500 hover:bg-emerald-700 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm inline-flex items-center px-3 py-2.5 text-center mr-2 dark:focus:ring-emerald-500"
		>
			Si, estoy seguro
		</button>
		<button
			class="text-gray-900 bg-white hover:bg-gray-100 focus:ring-4 focus:ring-primary-300 border border-gray-200 font-medium inline-flex items-center rounded-lg text-sm px-3 py-2.5 text-center dark:bg-[#1d1d1d] dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-neutral-700 dark:focus:ring-gray-700"
			type="button"
			data-drawer-dismiss="desarchivar-menu"
			aria-controls="desarchivar-menu"
		>
			No, cancelar
		</button>
		</form>
		
		
	</div>

	<!-- Add Product Drawer -->
	<div
		id="drawer-create-product-default"
		class="fixed top-0 right-0 z-40 w-full h-screen max-w-xs p-4 overflow-y-auto transition-transform translate-x-full bg-white dark:bg-[#1d1d1d]"
		tabindex="-1"
		aria-labelledby="drawer-label"
		aria-hidden="true"
	>
		<h5
			id="drawer-label"
			class="inline-flex items-center mb-6 text-sm font-semibold text-gray-500 uppercase dark:text-gray-400"
		>
			Nuevo Formulario
		</h5>
		<button
			type="button"
			data-drawer-dismiss="drawer-create-product-default"
			aria-controls="drawer-create-product-default"
			class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 absolute top-2.5 right-2.5 inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white"
		>
			<svg
				aria-hidden="true"
				class="w-5 h-5"
				fill="currentColor"
				viewBox="0 0 20 20"
				xmlns="http://www.w3.org/2000/svg"
				><path
					fill-rule="evenodd"
					d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
					clip-rule="evenodd"></path></svg
			>
			<span class="sr-only">Cerrar menu</span>
		</button>
		<form action="/api/create/admin-new-form" method="POST">
			<div class="space-y-4">
				<div>
					<label
						for="titulo-form"
						class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
						>Titulo del formulario</label
					>
					<input
						type="text"
						name="titulo-form"
						id="nombre-service"
						class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#967432] focus:border-[#967432] block w-full p-2.5 dark:bg-neutral-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]"
						placeholder="Nombre del formulario"
						required=""
					/>
				</div>

				<div>
					<label
						for="categoria-form"
						class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
						>Categoria</label
					>
					<input
						type="text"
						name="categoria-form"
						id="categoria-form"
						class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#967432] focus:border-[#967432] block w-full p-2.5 dark:bg-neutral-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]"
						placeholder="Añade la categoria del form"
						required=""
					/>
				</div>
				<div>
					<label
						for="json-update"
						class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
						>Json del formulario</label
					>
					<textarea
						id="json-update"
						name="json-update"
						rows="4"
						class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-[#8c681d] focus:border-[#8c681d] dark:bg-neutral-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]"
						placeholder="Pega aqui el Json del formulario"></textarea>
				</div>
				<div>
					<label
						for="tema-form-update"
						class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
						>Tema del formulario (opcional)</label
					>
					<textarea
						id="tema-form-update"
						name="tema-form-update"
						rows="4"
						class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-[#8c681d] focus:border-[#8c681d] dark:bg-neutral-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]"
						placeholder="Pega el Json del tema"></textarea>
				</div>
				<div>
					<label
						for="descripcion-form-update"
						class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
						>descripcion</label
					>
					<textarea
						id="descripcion-form-update"
						name="descripcion-form-update"
						rows="4"
						class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-[#8c681d] focus:border-[#8c681d] dark:bg-neutral-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]"
						placeholder="Añade una descripcion del formulario"></textarea>
				</div>
				<div>
					<label
						for="estado"
						class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
						>Estado</label
					>
					<select
						id="estado"
						name="estado"
						class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#8c681d] focus:border-[#8c681d] block w-full p-2.5 dark:bg-neutral-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]"
					>
						<option value="" disabled="" selected="">--</option>
						<option value="true">Activo</option>
						<option value="false">Inactivo</option>
					</select>
				</div>
				
				<div
					class="bottom-0 left-0 flex justify-center w-full pb-4 space-x-4 md:px-4 md:absolute"
				>
					<button
						type="submit"
						class="text-white w-full justify-center bg-[#8c681d] hover:bg-[#8c681d] focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-[#967432] dark:hover:bg-[#8c681d] dark:focus:ring-[#8c681d]"
					>
						Añadir formulario
					</button>
					<button
						type="button"
						data-drawer-dismiss="drawer-create-product-default"
						aria-controls="drawer-create-product-default"
						class="inline-flex w-full justify-center text-gray-500 items-center bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-primary-300 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:bg-neutral-700 dark:text-gray-300 dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-600"
					>
						<svg
							aria-hidden="true"
							class="w-5 h-5 -ml-1 sm:mr-1"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
							xmlns="http://www.w3.org/2000/svg"
							><path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M6 18L18 6M6 6l12 12"></path></svg
						>
						Cancelar
					</button>
				</div>
			</div>
		</form>
	</div>

	<!-- Main modal -->
	<div id="course-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
		<div class="relative p-4 w-full max-w-lg max-h-full">
			<!-- Modal content -->
			<div class="relative bg-white rounded-lg shadow-sm dark:bg-[#1d1d1d]">
				<!-- Modal header -->
				<div class="flex items-center justify-between p-4 md:p-5">
					<h3 class="text-lg text-gray-500 dark:text-gray-400">
						Link del formulario
					</h3>
					<button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm h-8 w-8 ms-auto inline-flex justify-center items-center dark:hover:bg-neutral-700 dark:hover:text-white" data-modal-toggle="course-modal">
						<svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
							<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
						</svg>
						<span class="sr-only">Close modal</span>
					</button>
				</div>
				<!-- Modal body -->
				<div class="px-4 pb-4 md:px-5 md:pb-5">
					<label for="share-id" class="text-sm font-medium text-gray-900 dark:text-white mb-2 block">Comparte este formulario para un cliente:</label>
					<div class="relative mb-4">
						<input id="share-id" type="text" class="col-span-6 bg-gray-50 border border-gray-300 text-gray-500 text-sm rounded-lg focus:ring-[#8c681d] focus:border-[#8c681d] block w-full p-2.5 dark:bg-neutral-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-[#8c681d] dark:focus:border-[#8c681d]" value="" disabled readonly>
						<button id="copias" data-copy-to-clipboard-target="share-id" data-tooltip-target="tooltip-share-id" class="absolute end-2 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-neutral-800 rounded-lg p-2 inline-flex items-center justify-center dark:bg-neutral-800">
							<span id="default-icon-share-id">
								<svg class="w-3.5 h-3.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 20">
									<path d="M16 1h-3.278A1.992 1.992 0 0 0 11 0H7a1.993 1.993 0 0 0-1.722 1H2a2 2 0 0 0-2 2v15a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2Zm-3 14H5a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2Zm0-4H5a1 1 0 0 1 0-2h8a1 1 0 1 1 0 2Zm0-5H5a1 1 0 0 1 0-2h2V2h4v2h2a1 1 0 1 1 0 2Z"/>
								</svg>
							</span>
							<span id="success-icon-share-id" class="hidden">
								<svg class="w-3.5 h-3.5 text-[#8c681d] dark:text-[#8c681d]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 12">
									<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5.917 5.724 10.5 15 1.5"/>
								</svg>
							</span>
						</button>
						<div id="tooltip-share-id" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white transition-opacity duration-300 bg-neutral-900 rounded-lg shadow-xs opacity-0 tooltip dark:bg-neutral-800">
							<span id="default-tooltip-message-share-id">Copiar</span>
							<span id="success-tooltip-message-share-id" class="hidden">Copiado!</span>
							<div class="tooltip-arrow" data-popper-arrow></div>
						</div>
					</div>
					<button type="button" data-modal-hide="course-modal" class="py-2.5 px-5 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-[#8c681d] focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:text-white dark:border-gray-600 dark:hover:text-white dark:bg-[#967432] dark:hover:bg-[#8c681d]">Cerrar</button>
				</div>
			</div>
		</div>
	</div>

	<script>
		document.addEventListener("DOMContentLoaded", () => {
		  // Tipar los botones como HTMLElement (con dataset)
		  const btns = document.querySelectorAll<HTMLElement>("[data-service-update]");
	  
		  // Helper para setear .value de inputs/textarea de forma segura
		  function setValue(id: string, val: string) {
			const el = document.getElementById(id) as (HTMLInputElement | HTMLTextAreaElement | null);
			if (el) el.value = val ?? "";
		  }
	  
		  btns.forEach((btn) => {
			btn.addEventListener("click", () => {
			  const id   = btn.dataset.id ?? "";
			  const titulo = btn.dataset.titulo ?? "";
			  const json = btn.dataset.json ?? "";
			  const tema = btn.dataset.tema ?? "";
			  const categoria   = btn.dataset.slug ?? "";
			  const descripcion    = btn.dataset.descripcion ?? "";
			  const estado = btn.dataset.estado ?? "";
	  
			  setValue("modal_form_id", id);
			  setValue("titulo-update-form", titulo);
			  setValue("json-form", json);
			  setValue("tema-form", tema);
			  setValue("categoria-form-update", categoria);
			  setValue("descripcion-form", descripcion);
			  setValue("update-form-estado", estado);
			});
		  });
		});
	</script>
	<script is:inline>
		document.addEventListener("DOMContentLoaded", () => {
		  // Tipar los botones como HTMLElement (con dataset)
		  const btns = document.querySelectorAll("[data-link-share]");
	  
		  // Helper para setear .value de inputs/textarea de forma segura
		  function setValue(id, val) {
			const el = document.getElementById(id);
			if (el && "value" in el) el.value = val ?? "";
		  }
	  
		  btns.forEach((btn) => {
			btn.addEventListener("click", () => {
			  const id   = btn.dataset.id ?? "";
			  const base = btn.dataset.base ?? "https://dashboard.sotomayorconsulting.com/forms"; // prefijo configurable
	  
			  if (!id) return;
	  
			  const relativeHref = `${base}/${encodeURIComponent(id)}`;
	  
			  // 1) Inyectar en input (para copiar)
			  setValue("share-id", relativeHref);
	  
			  // 2) (Opcional) Actualizar un anchor visible
			  const a = document.getElementById("share-link-a");
			  if (a) {
				a.setAttribute("href", relativeHref);
				a.textContent = relativeHref;
			  }
			});
		  });
		});
	</script>
	  <script is:inline>
			document.addEventListener("DOMContentLoaded", () => {
			const form       = document.getElementById("archivar_form");
			const uidInput   = document.getElementById("servicio_id");
			
		
			// Botones que abren el modal (uno por fila/usuario)
			const btns = document.querySelectorAll("[data-open-estado]");
		
			btns.forEach((btn) => {
				btn.addEventListener("click", () => {
				const uid = btn.dataset.formId || "";
		
				// Inyecta user_id y muestra nombre
				uidInput.value = uid;
				nameSpan.textContent = uname ? ` · ${uname}` : "";
		
				
				});
			});
		
			// Anti doble-submit (opcional)
			form.addEventListener("submit", () => {
				const submitBtn = form.querySelector('button[type="submit"]');
				if (submitBtn) submitBtn.disabled = true;
			});
			});
	  </script>
	  <script is:inline>
		document.addEventListener("DOMContentLoaded", () => {
		  const form       = document.getElementById("desarchivar_form");
		  const uidInput   = document.getElementById("des_servicio_id");
		  
	  
		  // Botones que abren el modal (uno por fila/usuario)
		  const btns = document.querySelectorAll("[data-open-desarchivado]");
	  
		  btns.forEach((btn) => {
			btn.addEventListener("click", () => {
			  const uid = btn.dataset.formId || "";
	  
			  // Inyecta user_id y muestra nombre
			  uidInput.value = uid;
			  nameSpan.textContent = uname ? ` · ${uname}` : "";
	  
			  
			});
		  });
	  
		  // Anti doble-submit (opcional)
		  form.addEventListener("submit", () => {
			const submitBtn = form.querySelector('button[type="submit"]');
			if (submitBtn) submitBtn.disabled = true;
		  });
		});
	  </script>
	  <script is:inline>
		document.addEventListener("DOMContentLoaded", () => {
		  const btn   = document.getElementById('copias');
		  const visto = document.getElementById('success-icon-share-id');
		  const papel = document.getElementById('default-icon-share-id');
		 
	  
		  let t = null; // guarda el timeout para limpiar si hay clicks rápidos
	  
		  btn?.addEventListener('click', () => {
			if (!visto || !papel ) return;
	  
			// Mostrar ✓ y ocultar el icono normal
			visto.classList.remove('hidden');
			papel.classList.add('hidden');
	  
			// Reiniciar timer si vuelven a hacer click antes de 1s
			if (t) clearTimeout(t);
	  
			t = setTimeout(() => {
			  // Volver al estado normal
			  visto.classList.add('hidden');
			  papel.classList.remove('hidden');
			  t = null;
			}, 1000); // 1 segundo
		  });
		});
	  </script>
	

	<NavPagination
		page={page}
		total={total}
		pageSize={20}               
		searchParams={Astro.url.searchParams}
	/>
</div>
